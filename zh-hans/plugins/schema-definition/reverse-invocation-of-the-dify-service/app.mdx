---
title: App
---



{/* 
  贡献者注意:
  ----------------
  本文档为旧版文档，即将弃用。
  请勿对此版本进行更改。
  所有更新应指向新版本：
  /plugin-dev-zh/9242-reverse-invocation-app
*/}

<Card title="本文档即将弃用" icon="circle-exclamation" href="/plugin-dev-zh/9242-reverse-invocation-app">
  <p>作为我们文档重组的一部分，此页面正在逐步淘汰。</p>
  
  <p><u><b>点击此卡片</b></u>跳转到包含最新信息的更新版本。</p>
  
  <p>如果您在新的文档中发现任何差异或需要改进的地方，请使用页面底部的“报告问题”按钮。</p>
</Card>

反向调用 App 指的是插件能够访问 Dify 中的 App 数据。该模块同时支持流式与非流式的 App 调用。

**接口类型：**

* 对于 `Chatbot/Agent/Chatflow`  类型应用而言，它们都属于聊天类型的应用，因此拥有相同类型的输入参数和输出参数，因此可被统一视为**聊天接口。**
* 对于 Workflow 应用而言，它单独占据一个 **Workflow 接口。**
* 对于 Completion（文本生成应用）应用而言，它单独占据一个 **Completion 接口**。

请注意，插件仅允许访问插件所在的 Workspace 中的 App。

### 调用聊天接口

#### **入口**

```python
    self.session.app.chat
```

#### **接口规范**

```python
    def invoke(
        self,
        app_id: str,
        inputs: dict,
        response_mode: Literal["streaming", "blocking"],
        conversation_id: str,
        files: list,
    ) -> Generator[dict, None, None] | dict:
        pass
```

当 `response_mode` 为 `streaming` 时，该接口将直接返回 `Generator[dict]`，否则直接返回 `dict`，具体的接口字段请参考 `ServiceApi` 的返回结果。

#### **用例**

我们可以在一个 `Endpoint` 中调用 Chat 类型的 App，并将结果直接返回。

```python
import json
from typing import Mapping
from werkzeug import Request, Response
from dify_plugin import Endpoint

class Duck(Endpoint):
    def _invoke(self, r: Request, values: Mapping, settings: Mapping) -> Response:
        """
        Invokes the endpoint with the given request.
        """
        app_id = values["app_id"]

        def generator():
            response = self.session.app.workflow.invoke(
                app_id=app_id, inputs={}, response_mode="streaming", files=[]
            )

            for data in response:
                yield f"{json.dumps(data)} <br>"

        return Response(generator(), status=200, content_type="text/html")
```

### 调用 Workflow 接口

#### **入口**

```python
    self.session.app.workflow
```

#### **接口规范**

```python
    def invoke(
        self,
        app_id: str,
        inputs: dict,
        response_mode: Literal["streaming", "blocking"],
        files: list,
    ) -> Generator[dict, None, None] | dict:
        pass
```

### 调用 Completion 接口

#### **入口**

```python
    self.session.app.completion
```

**接口规范**

```python
    def invoke(
        self,
        app_id: str,
        inputs: dict,
        response_mode: Literal["streaming", "blocking"],
        files: list,
    ) -> Generator[dict, None, None] | dict:
        pass
```

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

<CardGroup cols="2">
    <Card
        title="编辑此页面"
        icon="pen-to-square"
        href="https://github.com/langgenius/dify-docs/edit/main/zh-hans/plugins/schema-definition/reverse-invocation-of-the-dify-service/app.mdx"
    >
        通过直接提交修改来帮助改进文档内容
    </Card>
    <Card
        title="提交问题"
        icon="github"
        href="https://github.com/langgenius/dify-docs/issues/new?title=文档问题%3A%20&body=%23%23%20问题描述%0A%3C%21--%20请简要描述您发现的问题%20--%3E%0A%0A%23%23%20页面链接%0Ahttps%3A%2F%2Fgithub.com%2Flanggenius%2Fdify-docs%2Fblob%2Fmain%2Fzh-hans/plugins/schema-definition/reverse-invocation-of-the-dify-service%2Fapp.mdx%0A%0A%23%23%20建议修改%0A%3C%21--%20如果有具体的修改建议，请在此说明%20--%3E%0A%0A%3C%21--%20感谢您对文档质量的关注！%20--%3E"
    >
        发现错误或有改进建议？请提交问题反馈
    </Card>
</CardGroup>
