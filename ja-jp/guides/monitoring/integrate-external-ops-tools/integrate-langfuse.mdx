---
title: LangFuseとの統合
---


### Langfuseとは

LangfuseはLLMアプリケーションの開発者がデバッグ、分析、イテレーション等を使用してアプリケーションのパフォーマンスを向上させるためのツールです。

<Info>
Langfuseの公式サイト：[https://langfuse.com/](https://langfuse.com/)
</Info>

***

### Langfuseの使い方

1. Langfuseの[公式サイト](https://langfuse.com/)から登録し、ログインする。
2. Langfuseからプロジェクトを作成します
ログイン後、ホームページの **New** をクリックし、新たな**プロジェクト**を作成します。このプロジェクトは、Dify内の**アプリ**と連動したデータモニタリングに使用されます。

<div class="image-side-by-side">
  <img
src="https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/75bed34765ed7d0e933a0069ecb094dd.png)

プロジェクトの名前を付けます。

![プロジェクトの名前を付けます。](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/26cfbb94e312a100c39e217fdd0b4406.png)

3. プロジェクト認証情報の作成のために、左のサイドバーでプロジェクト **設定** をクリックする。

![左のサイドバーをクリックします](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/2ed72a6761f2977201c29e67e5bc634c.png)

**Create API Key**をクリックし，新たな認証情報を作ります。

![プロジェクトのAPI Keyを作ります。](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/3c3fbd5392d37fbccf1f9ef76c54f0bc.png)

**Secret Key** と **Public Key，Host** をコピーし、保存します。

![APIキーの設定を取得する](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/a2ff67951ce300082d875eae8458c8c7.png)

4. Dify アプリの中に Langfuse を設定します。監視用のアプリのサイトメニューの**監視**ボタンをクリックし，**設定**をクリックします。

![Langfuseを設定します](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/ebc84b328ad37c0f6dbca6101e1f90ab.png)

それから，Langfuse から作った **Secret Key, Public Key** と **Host** を**設定**の中に貼り付け、保存します。

![Langfuseを設定します](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/5bfa409e7a073f133f21146535401512.png)

保存に成功すると、現在のページで監視状態を見ることができます。

![監視状態を見る](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/de3b4e21db7fd39b4fa4cb4d54d1079e.png)

***

### Langfuse ページで監視データをチェックします

設定した後， Difyのアプリや生産データは Langfuse の中にチェクをできます。

![Dify 内でのアプリの調整](https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/a1370fdbb79257cba31a565ac6764802.png"
className="mx-auto"
alt=""
/>
  <img
src="https://assets-docs.dify.ai/dify-enterprise-mintlify/jp/guides/monitoring/integrate-external-ops-tools/b4fc3474336d5f60dc049c9153454496.png"
className="mx-auto"
alt=""
/>
</div>

***

### 監視データのリスト

#### ワークフローとチャットフローの情報を追跡

**ワークフローとチャットフローの追跡**

<table>
  <thead>
    <tr>
      <th>Workflow</th>
      <th>LangFuse Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>workflow\_app\_log\_id/workflow\_run\_id</td>
      <td>id</td>
    </tr>
    <tr>
      <td>user\_session\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>workflow\_{id}</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>Model token consumption</td>
      <td>usage</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>error</td>
      <td>level</td>
    </tr>
    <tr>
      <td>error</td>
      <td>status\_message</td>
    </tr>
    <tr>
      <td>\[workflow]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>\["message", conversation\_mode]</td>
      <td>session\_id</td>
    </tr>
    <tr>
      <td>conversion\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**Workflow Trace Info**

- workflow\_id - ワークフローのユニークID
- conversation\_id - 会話ID
- workflow\_run\_id - このランタイムのワークフローID
- tenant\_id - テナントID
- elapsed\_time - このランタイムの経過時間
- status - ランタイムのステータス
- version - ワークフローのバージョン
- total\_tokens - このランタイムで使用されたトークンの合計
- file\_list - 処理されたファイルのリスト
- triggered\_from - このランタイムをトリガしたソース
- workflow\_run\_inputs - このワークフローの入力
- workflow\_run\_outputs - このワークフローの出力
- error - エラーメッセージ
- query - ランタイムで使用されるクエリ
- workflow\_app\_log\_id - ワークフローアプリケーションログID
- message\_id - 関連するメッセージID
- start\_time - このランタイムの開始時刻
- end\_time - このランタイムの終了時刻
- workflow node executions - ワークフローノードのランタイム情報
- Metadata
  - workflow\_id - ワークフローのユニークID
  - conversation\_id - 会話ID
  - workflow\_run\_id - このランタイムのワークフローID
  - tenant\_id - テナントID
  - elapsed\_time - このランタイムの経過時間
  - status - 運用状態
  - version - ワークフローのバージョン
  - total\_tokens - このランタイムで使用されたトークンの合計
  - file\_list - 処理されたファイルのリスト
  - triggered\_from - このランタイムをトリガしたソース

#### Message Trace 情報

**LLM会話を追跡するため**

<table>
  <thead>
    <tr>
      <th>Message</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>message\_id</td>
      <td>id</td>
    </tr>
    <tr>
      <td>user\_session\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>message\_{id}</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>Model token consumption</td>
      <td>usage</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>error</td>
      <td>level</td>
    </tr>
    <tr>
      <td>error</td>
      <td>status\_message</td>
    </tr>
    <tr>
      <td>\["message", conversation\_mode]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>conversation\_id</td>
      <td>session\_id</td>
    </tr>
    <tr>
      <td>conversion\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**Message Trace Info**

- message\_id - メッセージID
- message\_data - メッセージデータ
- user\_session\_id - ユーザーのセッションID
- conversation\_model - 会話モデル
- message\_tokens - メッセージトークン
- answer\_tokens - 回答トークン
- total\_tokens - メッセージと回答のトータルトークン
- error - エラーメッセージ
- inputs - 入力データ
- outputs - 出力データ
- file\_list - 処理されたファイルのリスト
- start\_time - 開始時刻
- end\_time - 終了時刻
- message\_file\_data - 関連ファイルデータのメッセージ
- conversation\_mode - 会話モード
- Metadata
  - conversation\_id - 会話ID
  - ls\_provider - モデルプロバイダ
  - ls\_model\_name - モデルID
  - status - メッセージステータス
  - from\_end\_user\_id - 送信ユーザーID
  - from\_account\_id - 送信アカウントID
  - agent\_based - エージェントベースか
  - workflow\_run\_id - このランタイムのワークフローID
  - from\_source - メッセージのソース
  - message\_id - メッセージID

#### Moderation Trace 情報

**会話モデレーションを追跡するため**

<table>
  <thead>
    <tr>
      <th>Moderation</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>moderation</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[moderation]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**Message Trace Info**

- message\_id - メッセージID
- user\_id - ユーザーID
- workflow\_app\_log\_id - ワークフローアプリケーションログID
- inputs - レビュー用の入力データ
- message\_data - メッセージデータ
- flagged - 注目対象としてフラグが立てられているか
- action - 実行すべき具体的なアクション
- preset\_response - 事前設定の応答
- start\_time - レビューの開始時刻
- end\_time - レビューの終了時刻
- Metadata
  - message\_id - メッセージID
  - action - 実行すべき具体的なアクション
  - preset\_response - 事前設定の応答

#### 提案された質問トレース情報

**提案された質問を追跡するため**

<table>
  <thead>
    <tr>
      <th>Suggested Question</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user\_id</td>
      <td>user\_id</td>
    </tr>
    <tr>
      <td>suggested\_question</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start\_time</td>
      <td>start\_time</td>
    </tr>
    <tr>
      <td>end\_time</td>
      <td>end\_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[suggested\_question]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message\_id</td>
      <td>parent\_observation\_id</td>
    </tr>
  </tbody>
</table>
**Message Trace Info**

* message\_id - メッセージID
* message\_data - メッセージデータ
* inputs - 入力データ
* outputs - 出力データ
* start\_time - 開始時刻
* end\_time - 終了時刻
* total\_tokens - トータルトークン
* status - メッセージの状態
* error - エラーメッセージ
* from_account_id - 送信元アカウントのID
* agent_based - エージェントベースであるかどうか
* from_source - メッセージの発信元
* model_provider - モデルの提供者
* model_id - モデルのID
* suggested_question - 提案された質問
* level - ステータスのレベル
* status_message - ステータスメッセージ
* Metadata
  * message_id - メッセージのID
  * ls_provider - モデルの提供者
  * ls_model_name - モデルの名前
  * status - メッセージの状態
  * from_end_user_id - 送信元ユーザーのID
  * from_account_id - 送信元アカウントのID
  * workflow_run_id - このランタイムにおけるワークフローのID
  * from_source - メッセージの発信元

#### Dataset Retrieval Trace 情報

**ナレッジベースの取得を追跡するために使用**

<table>
  <thead>
    <tr>
      <th>データセットの取得</th>
      <th>LangFuse生成/トレース</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>user_id</td>
    </tr>
    <tr>
      <td>dataset_retrieval</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start_time</td>
      <td>start_time</td>
    </tr>
    <tr>
      <td>end_time</td>
      <td>end_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[dataset_retrieval]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message_id</td>
      <td>parent_observation_id</td>
    </tr>
  </tbody>
</table>
**Dataset Retrieval Trace Info**

* message_id - メッセージのID
* inputs - 入力メッセージ
* documents - ドキュメントデータ
* start_time - 開始時間
* end_time - 終了時間
* message_data - 消息数据
* Metadata
  * message_id - メッセージのID
  * ls_provider - モデルの提供者
  * ls_model_name - モデルの名前
  * status - モデルの状態
  * from_end_user_id - 送信元ユーザーのID
  * from_account_id - 送信元アカウントのID
  * agent_based - エージェントベースであるかどうか
  * workflow_run_id - このランタイムにおけるワークフローのID
  * from_source - メッセージの発信元

#### Tool Trace 情報

**ツールの呼び出しを追跡するために使用**

<table>
  <thead>
    <tr>
      <th>ツール</th>
      <th>LangFuse生成/トレース</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>user_id</td>
    </tr>
    <tr>
      <td>tool_name</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start_time</td>
      <td>start_time</td>
    </tr>
    <tr>
      <td>end_time</td>
      <td>end_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\["tool", tool_name]</td>
      <td>tags</td>
    </tr>
    <tr>
      <td>message_id</td>
      <td>parent_observation_id</td>
    </tr>
  </tbody>
</table>
**Tool Trace Info**

* message_id - メッセージのID
* tool_name - ツール名
* start_time - 開始時間
* end_time - 終了時間
* tool_inputs - ツールの入力
* tool_outputs - ツールの出力
* error - エラーメッセージ（存在する場合）
* inputs - メッセージの入力
* outputs - メッセージの出力
* tool_config - ツールの構成
* tool_parameters - ツールのパラメータ
* file_url - 関連ファイルのURL
* Metadata
  * message_id - メッセージのID
  * tool_name - ツール名
  * tool_inputs - ツールの入力
  * tool_outputs - ツールの出力
  * tool_config - ツールの構成
  * error - エラーメッセージ
  * tool_parameters - ツールのパラメータ
  * message_file_id - メッセージファイルのID
  * created_by_role - 作成者の役割
  * created_user_id - 作成ユーザーのID

#### Generate Name Trace 情報

**会話タイトル生成の追跡に使用**

<table>
  <thead>
    <tr>
      <th>Generate Name</th>
      <th>LangFuse Generation/Trace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>user_id</td>
    </tr>
    <tr>
      <td>generate_name</td>
      <td>name</td>
    </tr>
    <tr>
      <td>start_time</td>
      <td>start_time</td>
    </tr>
    <tr>
      <td>end_time</td>
      <td>end_time</td>
    </tr>
    <tr>
      <td>inputs</td>
      <td>input</td>
    </tr>
    <tr>
      <td>outputs</td>
      <td>output</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>metadata</td>
    </tr>
    <tr>
      <td>\[generate_name]</td>
      <td>tags</td>
    </tr>
  </tbody>
</table>
**Generate Name Trace Info**

* conversation_id - 会話のID
* inputs - 入力データ
* outputs - 生成されたセッション名
* start_time - 開始時間
* end_time - 終了時間
* tenant\_id - テナントID
* Metadata
  * conversation_id - 会話のID
  * tenant\_id - テナントID

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

<CardGroup cols="2">
    <Card
        title="このページを編集する"
        icon="pen-to-square"
        href="https://github.com/langgenius/dify-docs/edit/main/ja-jp/guides/monitoring/integrate-external-ops-tools/integrate-langfuse.mdx"
    >
        直接貢献することでドキュメントの改善にご協力ください
    </Card>
    <Card
        title="問題を報告する"
        icon="github"
        href="https://github.com/langgenius/dify-docs/issues/new?title=ドキュメントの問題%3A%20rate-langf&body=%23%23%20問題の説明%0A%3C%21--%20発見した問題について簡単に説明してください%20--%3E%0A%0A%23%23%20ページリンク%0Ahttps%3A%2F%2Fgithub.com%2Flanggenius%2Fdify-docs%2Fblob%2Fmain%2Fja-jp/guides/monitoring/integrate-external-ops-tools%2Fintegrate-langfuse.mdx%0A%0A%23%23%20提案される変更%0A%3C%21--%20特定の変更案がある場合は、ここで説明してください%20--%3E%0A%0A%3C%21--%20ドキュメントの品質向上にご協力いただきありがとうございます！%20--%3E"
    >
        エラーを見つけたり提案がありますか？お知らせください
    </Card>
</CardGroup>
