---
dimensions:
  type:
    primary: reference
    detail: examples
  level: intermediate
standard_title: Endpoint
language: ja
title: エンドポイント
description: 作成者: Yeuoly、Allen このドキュメントでは、Difyプラグインにおけるエンドポイントの構造と実装方法について、虹猫（Neko）プロジェクトを例に詳しく説明します。内容は、エンドポイントグループの定義方法、インターフェースの設定、_invokeメソッドの実装、リクエストとレスポンスの処理を含みます。ドキュメントでは、さまざまなYAML設定フィールドの意味と使用方法を詳細に解説しています。
---

本稿では、[虹猫](/plugin_dev_ja/9231-extension-plugin.ja)プロジェクトを例に、プラグイン内のエンドポイントの構造について説明します。エンドポイントは、プラグインが外部に公開するHTTPインターフェースであり、外部システムとの統合に使用できます。完全なプラグインコードは、[Githubリポジトリ](https://github.com/langgenius/dify-plugin-sdks/tree/main/python/examples/neko)を参照してください。

### グループ定義

`Endpoint` グループは複数の `Endpoint` の集合であり、`Dify` プラグイン内で新しい `Endpoint` を作成する際に、以下のような設定を記入する必要がある場合があります。

![](https://assets-docs.dify.ai/2024/11/763dbf86e4319591415dc5a1b6948ccb.png)

`Endpoint Name` 以外に、グループの設定情報を記述することで新しいフォーム項目を追加できます。保存をクリックすると、そこに含まれる複数のインターフェースが表示され、それらは同じ設定情報を使用します。

![](https://assets-docs.dify.ai/2024/11/b778b7093b7df0dc80a476c65ddcbe58.png)

#### **構造**

* `settings`(map\[string] [ProviderConfig](/plugin_dev_ja/0411-general-specifications#providerconfig.ja) )：エンドポイント設定定義
* `endpoints`(list\[string], required)：具体的な `endpoint` インターフェース定義を指します

```yaml
settings:
  api_key:
    type: secret-input
    required: true
    label:
      en_US: API key
      zh_Hans: API key
      ja_Jp: API key
      pt_BR: API key
    placeholder:
      en_US: Please input your API key
      zh_Hans: 请输入你的 API key
      ja_Jp: あなたの API key を入れてください
      pt_BR: Por favor, insira sua chave API
endpoints:
  - endpoints/duck.yaml
  - endpoints/neko.yaml
```

### インターフェース定義

* `path`(string)：werkzeugインターフェース標準に従います
* `method`(string)：インターフェースメソッド。`HEAD` `GET` `POST` `PUT` `DELETE` `OPTIONS` のみをサポートします
* `extra`(object)：基本情報以外の設定情報
  * `python`(object)
    * `source`(string)：このインターフェースを実装するソースコード

```yaml
path: "/duck/<app_id>"
method: "GET"
extra:
  python:
    source: "endpoints/duck.py"
```

### インターフェース実装

`dify_plugin.Endpoint` を継承したサブクラスを実装し、`_invoke` メソッドを実装する必要があります。

* **入力パラメータ**
  * `r`(Request)：`werkzeug` の `Request` オブジェクト
  * `values`(Mapping)：pathから解析されたパスパラメータ
  * `settings`(Mapping)：この `Endpoint` の設定情報
* **戻り値**
  * `werkzeug` の `Response` オブジェクト。ストリーミング応答をサポートします
  * 文字列の直接返却はサポートしていません

サンプルコード：

```python
import json
from typing import Mapping
from werkzeug import Request, Response
from dify_plugin import Endpoint

class Duck(Endpoint):
    def _invoke(self, r: Request, values: Mapping, settings: Mapping) -> Response:
        """
        Invokes the endpoint with the given request.
        """
        app_id = values["app_id"]

        def generator():
            yield f"{app_id} <br>"

        return Response(generator(), status=200, content_type="text/html")
```

## 注意事項

* エンドポイントはプラグインが呼び出されたときにのみインスタンス化され、常時実行されるサービスではありません
* エンドポイントを開発する際は、セキュリティに注意し、危険な操作の実行を避けてください
* エンドポイントは、Webhookコールバックの処理や、他のシステムが接続するためのインターフェースの提供に使用できます

プラグイン開発を学習している場合は、まず[プラグイン開発入門ガイド](/plugin_dev_ja/0211-getting-started-dify-tool.ja)と[開発者向けチートシート](/plugin_dev_ja/0131-cheatsheet.ja)を読むことをお勧めします。

## 関連リソース

- [プラグイン開発の基本概念](/plugin_dev_ja/0111-getting-started-dify-plugin.ja) - プラグイン開発の全体的なアーキテクチャを理解する
- [虹猫（Neko）インスタンス](/plugin_dev_ja/9231-extension-plugin.ja) - 拡張プラグイン開発の例
- [共通仕様定義](/plugin_dev_ja/0411-general-specifications.ja) - ProviderConfigなどの共通構造を理解する
- [Slackボットプラグイン開発例](/plugin_dev_ja/0432-develop-a-slack-bot-plugin.ja) - 別のプラグイン開発例
- [プラグイン開発入門ガイド](/plugin_dev_ja/0211-getting-started-dify-tool.ja) - ゼロからプラグインを開発する
- [Difyサービスの逆呼び出し](/plugin_dev_ja/9241-reverse-invocation.ja) - 逆呼び出し機能の使用方法を理解する